{% extends "base.html" %}
{% block title %}Метрики — ParkShare{% endblock %}

{% block content %}
<section class="ps-section ps-section--flush-top">
    <div class="ps-section-header ps-section-header--stack">
        <div>
            <p class="ps-kicker">Внутренний дашборд</p>
            <h1 class="ps-section-title">Ключевые метрики</h1>
            <p class="ps-section-subtitle">Простой срез по бронированиям и AI-сессиям. Доступно только сотрудникам.</p>
        </div>
    </div>
    <div class="ps-grid ps-grid--gap-lg ps-grid--2col">
        <article class="ps-card ps-card--elevated">
            <div class="ps-card-header"><h2 class="ps-card-title">Воронка бронирований</h2></div>
            <div class="ps-card-body">
                <div class="ps-list-title">Всего бронирований: {{ total_bookings }}</div>
                <div class="ps-list-title">Служебные брони: {{ business_bookings }}</div>
            </div>
        </article>
        <article class="ps-card ps-card--elevated">
            <div class="ps-card-header"><h2 class="ps-card-title">AI/предпочтения</h2></div>
            <div class="ps-card-body">
                <div class="ps-list-title">Сессий с сохранёнными предпочтениями: {{ ai_sessions }}</div>
            </div>
        </article>
    </div>
    <div class="ps-grid ps-grid--gap-lg ps-grid--2col">
        <article class="ps-card">
            <div class="ps-card-header"><h2 class="ps-card-title">Последние 7 дней</h2></div>
            <div class="ps-card-body">
                <div class="ps-list-title">map_open: {{ last7.funnel.map_open|default:0 }}</div>
                <div class="ps-list-title">spot_select: {{ last7.funnel.spot_select|default:0 }}</div>
                <div class="ps-list-title">booking_confirm_open: {{ last7.funnel.booking_confirm_open|default:0 }}</div>
                <div class="ps-list-title">booking_created: {{ last7.funnel.booking_created|default:0 }}</div>
                <div class="ps-list-title">repeat_visit: {{ last7.funnel.repeat_visit|default:0 }}</div>
                <div class="ps-list-title">map→spot: {{ last7.conversions.map_to_spot }}%</div>
                <div class="ps-list-title">spot→confirm: {{ last7.conversions.spot_to_confirm }}%</div>
                <div class="ps-list-title">confirm→booking: {{ last7.conversions.confirm_to_booking }}%</div>
                <div class="ps-list-title">A/B bookings: {{ last7.variants.A.booking_created|default:0 }} / {{ last7.variants.B.booking_created|default:0 }}</div>
            </div>
        </article>
        <article class="ps-card">
            <div class="ps-card-header"><h2 class="ps-card-title">Последние 30 дней</h2></div>
            <div class="ps-card-body">
                <div class="ps-list-title">map_open: {{ last30.funnel.map_open|default:0 }}</div>
                <div class="ps-list-title">spot_select: {{ last30.funnel.spot_select|default:0 }}</div>
                <div class="ps-list-title">booking_confirm_open: {{ last30.funnel.booking_confirm_open|default:0 }}</div>
                <div class="ps-list-title">booking_created: {{ last30.funnel.booking_created|default:0 }}</div>
                <div class="ps-list-title">repeat_visit: {{ last30.funnel.repeat_visit|default:0 }}</div>
                <div class="ps-list-title">map→spot: {{ last30.conversions.map_to_spot }}%</div>
                <div class="ps-list-title">spot→confirm: {{ last30.conversions.spot_to_confirm }}%</div>
                <div class="ps-list-title">confirm→booking: {{ last30.conversions.confirm_to_booking }}%</div>
                <div class="ps-list-title">A/B bookings: {{ last30.variants.A.booking_created|default:0 }} / {{ last30.variants.B.booking_created|default:0 }}</div>
            </div>
        </article>
    </div>
</section>
{% endblock %}
