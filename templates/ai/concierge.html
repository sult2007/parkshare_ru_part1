{% extends "base.html" %}

{% block title %}Ассистент — ParkShare{% endblock %}

{% block content %}
<section class="ps-section ps-section--flush-top" data-route="assistant">
    <form style="display:none;">
        {% csrf_token %}
    </form>
    <div class="ps-landing__head">
        <div>
            <h1 class="ps-landing__title">Ассистент</h1>
            <p class="ps-landing__subtitle">Потоковый AI-консьерж для поиска парковки и скриптов поддержки.</p>
        </div>
        <div class="ps-chip-row">
            <span class="ps-chip ps-chip--soft">{% if user.is_authenticated %}{{ user.username }}{% else %}Гостевой режим{% endif %}</span>
            <span class="ps-chip ps-chip--soft">Реальный чат</span>
        </div>
    </div>

    <div class="ps-section-actions ps-section-actions--link">
        <a href="{% url 'landing' %}" class="ps-link ps-link-arrow">К карте</a>
    </div>

    <div class="ps-ai-grid">
        <div class="ps-ai-summary">
            <div class="ps-card ps-card--elevated">
                <h3 class="ps-card-title">Предустановленные подсказки</h3>
                <p class="ps-card-line ps-card-line--muted">Выберите и отправьте в один тап.</p>
                <div class="ps-ai-prompts" data-ai-prompts>
                    <button type="button" class="ps-chip" data-ai-prompt>Сформируй чат-скрипт для диспетчера парковки с VIP-клиентами.</button>
                    <button type="button" class="ps-chip" data-ai-prompt>Собери сводку по пиковым часам и дай рекомендации по динамическим тарифам.</button>
                    <button type="button" class="ps-chip" data-ai-prompt>Сценарий поддержки: клиент не может найти въезд. Какие шаги предложить?</button>
                    <button type="button" class="ps-chip" data-ai-prompt>Что добавить в онбординг партнёра, чтобы повысить NPS?</button>
                    <button type="button" class="ps-chip" data-ai-prompt>Сделай контрольный чек-лист для запуска новой парковки на выходные.</button>
                </div>
                <div class="ps-hint">История сохраняется в браузере. Авторизация привяжет её к аккаунту.</div>
            </div>
        </div>

        <div class="ps-ai-chat" data-ai-chat data-ai-history-key="ps_ai_chat_v2">
            <div class="ps-ai-chat__header">
                <div>
                    <p class="ps-kicker">Concierge</p>
                    <p class="ps-ai-title">AI-чат ParkShare</p>
                    <p class="ps-ai-subtitle">Спроси про цены, маршруты и сценарии для гостей.</p>
                </div>
                <div class="ps-ai-actions">
                    <button type="button" class="ps-btn ps-btn-ghost ps-btn-sm" data-ai-clear>Очистить</button>
                    <button type="button" class="ps-btn ps-btn-secondary ps-btn-sm" data-ai-stop hidden>Остановить</button>
                </div>
            </div>

            <div class="ps-ai-chat__body">
                <div class="ps-ai-prompts ps-ai-prompts--inline" data-ai-prompts>
                    <button type="button" class="ps-chip ps-chip--ghost" data-ai-prompt>Где припарковаться рядом?</button>
                    <button type="button" class="ps-chip ps-chip--ghost" data-ai-prompt>Построй маршрут до центра</button>
                </div>
                <div class="ps-ai-status" data-ai-status>История сохраняется локально. Готов к диалогу.</div>
                <div class="ps-ai-alerts" data-ai-alerts hidden></div>
                <div class="ps-ai-actions" data-ai-actions hidden></div>
                <div class="ps-ai-sessions" data-ai-sessions hidden></div>
                <div class="ps-ai-suggestions" data-ai-suggestions hidden></div>
                <div class="ps-ai-messages" data-ai-messages></div>
            </div>

            <div class="ps-ai-input">
                <textarea id="ai-input" class="ps-input" rows="3" placeholder="Опиши задачу или попроси маршрут…"></textarea>
                <div class="ps-ai-input__actions">
                    <div class="ps-ai-hint">Enter — отправить, Shift+Enter — перенос строки</div>
                    <div class="ps-ai-buttons">
                        <button type="button" class="ps-btn ps-btn-secondary ps-btn-sm" data-ai-regenerate hidden>Перегенерировать</button>
                        <button type="button" class="ps-btn ps-btn-sm" data-ai-send>Отправить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
    {% if ENABLE_AI_CHAT %}
        {% load static %}
        {% static 'js/chat.js' as chat_static %}
        <script src="{{ chat_static }}?v=2"></script>
    {% endif %}
{% endblock %}
