{% extends "base.html" %}
{% load static %}

{% block title %}Владелец — ParkShare RU{% endblock %}

{% block content %}
<section class="ps-section ps-section--flush-top" data-route="parking">
    <div class="ps-section-header ps-section-header--stack">
        <div>
            <p class="ps-kicker">Моя парковка</p>
            <h1 class="ps-section-title">Кабинет владельца</h1>
            <p class="ps-section-subtitle">
                Управляйте объектами, местами и бронированиями в одном мобильном интерфейсе.
            </p>
        </div>
        <div class="ps-section-actions">
            <a href="{% url 'map_page' %}" class="ps-btn ps-btn-secondary ps-btn-sm">К карте</a>
        </div>
    </div>
    <div class="ps-chip-row">
        <span class="ps-chip ps-chip--soft">Объектов: {{ lots|length }}</span>
        <span class="ps-chip ps-chip--soft">Мест: {{ spots|length }}</span>
        <span class="ps-chip ps-chip--soft">Брони: {{ bookings|length }}</span>
    </div>

    <div class="ps-grid ps-grid--gap-lg ps-grid--2col">
        <article class="ps-card ps-card--elevated">
            <div class="ps-card-header">
                <h2 class="ps-card-title">Мои объекты</h2>
            </div>
            <ul class="ps-list">
                {% for lot in lots %}
                    <li class="ps-list-item">
                        <div class="ps-list-main">
                            <div class="ps-list-title">
                                {{ lot.city }}, {{ lot.name }}
                            </div>
                            <div class="ps-list-subtitle">
                                {{ lot.get_parking_type_display }} · мест: {{ lot.spots.count }}
                            </div>
                        </div>
                        <span class="ps-badge ps-badge--neutral">
                            {{ lot.created_at|date:"d.m.Y" }}
                        </span>
                    </li>
                {% empty %}
                    <li class="ps-list-empty">
                        Пока нет ни одного объекта. Добавьте парковку через web-интерфейс владельца.
                    </li>
                {% endfor %}
            </ul>
        </article>

        <article class="ps-card">
            <div class="ps-card-header">
                <h2 class="ps-card-title">Места</h2>
            </div>
            <ul class="ps-list ps-list--compact">
                {% for spot in spots %}
                    <li class="ps-list-item">
                        <div class="ps-list-main">
                            <div class="ps-list-title">
                                {{ spot.lot.city }}, {{ spot.lot.name }} — {{ spot.name }}
                            </div>
                            <div class="ps-list-subtitle">
                                Тип: {{ spot.get_vehicle_type_display }} · {{ spot.hourly_price }} ₽/ч
                            </div>
                        </div>
                        <span class="ps-badge ps-badge--status-{{ spot.status }}">
                            {{ spot.get_status_display }}
                        </span>
                    </li>
                {% empty %}
                    <li class="ps-list-empty">
                        Мест пока нет.
                    </li>
                {% endfor %}
            </ul>
        </article>
    </div>

    <div class="ps-section">
        <div class="ps-section-header ps-section-header--stack">
            <div>
                <h2 class="ps-section-title">Бронирования по моим местам</h2>
                <p class="ps-section-subtitle">Кто сейчас бронирует и на какие суммы.</p>
            </div>
        </div>
        <div class="ps-reco-list">
            {% for booking in bookings %}
                <article class="ps-reco-card">
                    <div>
                        <div class="ps-reco-title">
                            {{ booking.spot.lot.city }}, {{ booking.spot.lot.name }} — {{ booking.spot.name }}
                        </div>
                        <div class="ps-reco-meta">
                            Пользователь: {{ booking.user.username }}
                        </div>
                        <div class="ps-reco-meta">
                            {{ booking.start_at|date:"d.m H:i" }} → {{ booking.end_at|date:"d.m H:i" }}
                        </div>
                        <div class="ps-reco-meta">
                            Сумма: {{ booking.total_price }} ₽
                        </div>
                    </div>
                    <span class="ps-chip ps-chip--soft">{{ booking.get_status_display }}</span>
                </article>
            {% empty %}
                <div class="ps-empty">
                    По вашим местам ещё не было бронирований.
                </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
