{% load static %}
<!doctype html>
<html lang="ru" data-platform="{{ PLATFORM_MODE|default:'RU' }}">
<head>
    <meta charset="utf-8">
    <title>{% block title %}ParkShare — smart parking{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <!-- PWA -->
    <meta name="theme-color" content="#050910">
    <link rel="manifest" href="{% url 'manifest' %}">
    <link rel="apple-touch-icon" sizes="192x192" href="{% static 'icons/icon-192.png' %}">
    <link rel="apple-touch-icon" sizes="512x512" href="{% static 'icons/icon-512.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'icons/icon-72.png' %}">

    <script>
        (function() {
            var storageKey = "ps-theme";
            var theme = "dark";
            try {
                var stored = localStorage.getItem(storageKey);
                var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
                if (stored === "dark" || stored === "light") {
                    theme = stored;
                } else {
                    theme = prefersDark ? "dark" : "light";
                }
            } catch (_) {
                theme = "dark";
            }
            document.documentElement.dataset.theme = theme;
            try { document.documentElement.style.colorScheme = theme; } catch (_) {}
            var meta = document.querySelector('meta[name="theme-color"]');
            if (meta) {
                meta.setAttribute("content", theme === "dark" ? "#050910" : "#f4f6fb");
            }
        })();
    </script>

    <link rel="stylesheet" href="{% static 'css/app.css' %}">

    {% block extra_head %}{% endblock %}
</head>
<body class="ps-body" data-user-id="{% if user.is_authenticated %}{{ user.id }}{% endif %}">
<div class="ps-app">
    <svg aria-hidden="true" focusable="false" style="position:absolute;width:0;height:0;overflow:hidden">
        <symbol id="ps-ic-allowed" viewBox="0 0 24 24">
            <path d="M6 3.5h8.2a5.3 5.3 0 0 1 0 10.6H9.5v6.4H6V3.5Zm3.5 3v4.5h4.7a2.2 2.2 0 1 0 0-4.5H9.5Z" fill="currentColor"/>
        </symbol>
        <symbol id="ps-ic-paid" viewBox="0 0 24 24">
            <path d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Zm.9 5c1.6 0 2.6.9 2.6 2.3 0 1.3-1 2.2-2.6 2.2h-2v2.1H9V8h3.9Zm-2 .9v2.7h1.9c.8 0 1.3-.5 1.3-1.3 0-.8-.5-1.4-1.3-1.4H10.9Z" fill="currentColor"/>
        </symbol>
        <symbol id="ps-ic-forbidden" viewBox="0 0 24 24">
            <path d="M12 3.2a8.8 8.8 0 1 1 0 17.6A8.8 8.8 0 0 1 12 3.2Zm0 2a6.8 6.8 0 0 0-5.3 10.9l9.4-9.4A6.8 6.8 0 0 0 12 5.2Zm0 13.6a6.8 6.8 0 0 0 5.3-10.9l-9.4 9.4a6.8 6.8 0 0 0 4.1 1.5Z" fill="currentColor"/>
        </symbol>
        <symbol id="ps-ic-ev" viewBox="0 0 24 24">
            <path d="m13.4 2-7 12.5h4.7L10.6 22 18 9.5h-4.6L13.4 2Z" fill="currentColor"/>
        </symbol>
        <symbol id="ps-ic-covered" viewBox="0 0 24 24">
            <path d="M4 10.5 12 5l8 5.5V21h-5.5v-4h-5v4H4v-10.5Zm2 1.4V19h2.5v-4h5v4H16v-7.1L12 8.7l-4 3.2Z" fill="currentColor"/>
        </symbol>
        <symbol id="ps-ic-locate" viewBox="0 0 24 24">
            <path d="M12 4.8a7.2 7.2 0 1 1 0 14.4 7.2 7.2 0 0 1 0-14.4Zm0 2a5.2 5.2 0 1 0 0 10.4 5.2 5.2 0 0 0 0-10.4Zm0 2.7a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5Z" fill="currentColor"/>
        </symbol>
    </svg>
    <header class="ps-topbar">
        <div class="ps-topbar__safe">
            <div class="ps-topbar__row">
                <a href="{% url 'landing' %}" class="ps-brand">
                    <span class="ps-brand__title">ParkShare</span>
                    <span class="ps-brand__region">{{ REGION_PROFILE }}</span>
                </a>
                <div class="ps-topbar__actions">
                    {% if user.is_authenticated %}
                        <a href="{% url 'accounts:profile' %}" class="ps-icon-btn" aria-label="Профиль" title="{{ user.username }}">
                            <svg class="ps-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9Zm0 11c-3.3 0-6 1.7-6 3.8V20h12v-1.7c0-2.1-2.7-3.8-6-3.8Z" fill="currentColor"/></svg>
                        </a>
                    {% else %}
                        <a href="{% url 'accounts:login' %}" class="ps-icon-btn" aria-label="Войти">
                            <svg class="ps-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a7 7 0 0 0-7 7v3.5A4.5 4.5 0 0 0 9.5 18h.8l1.7 2.6c.4.6 1.3.6 1.7 0L15.5 18h.8A4.5 4.5 0 0 0 19 13.5V10a7 7 0 0 0-7-7Zm0 2a5 5 0 0 1 5 5v3.5a2.5 2.5 0 0 1-2.5 2.5h-1.4l-1.1 1.8-1.1-1.8H9.5A2.5 2.5 0 0 1 7 13.5V10a5 5 0 0 1 5-5Z" fill="currentColor"/></svg>
                        </a>
                    {% endif %}
                    <button type="button" class="ps-icon-btn" data-theme-toggle aria-label="Переключить тему">
                        <svg class="ps-icon ps-icon-sun" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM12 2v2m0 16v2m10-10h-2M4 12H2m16.95 6.95-1.41-1.41M6.46 7.46 5.05 6.05m13.9 0-1.41 1.41M6.46 16.54l-1.41 1.41" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"/></svg>
                        <svg class="ps-icon ps-icon-moon" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 13.5A8.5 8.5 0 0 1 10.5 4 7 7 0 1 0 20 13.5Z" fill="currentColor"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="ps-main">
        <div class="ps-update-banner" data-sw-update hidden>
            <div class="ps-update-banner__text">Доступно обновление PWA.</div>
            <button type="button" class="ps-btn ps-btn-primary ps-btn-sm">Обновить</button>
        </div>
        {% block content %}{% endblock %}
    </main>

    <footer class="ps-footer">
        <div class="ps-footer__inner">
            <span>© {% now "Y" %} ParkShare RU</span>
            <span class="ps-footer__meta">PWA · Offline-first · AI pricing</span>
        </div>
    </footer>

    <button class="ps-back-to-top" type="button" data-back-to-top aria-label="Наверх">↑</button>

    <div class="ps-toast-container" aria-live="polite" aria-atomic="true"></div>

    <nav class="ps-tabbar" data-bottom-nav>
        <a href="{% url 'landing' %}" class="ps-tabbar__item" data-nav="map" aria-label="Карта">
            <span class="ps-tabbar__icon" aria-hidden="true">
                <svg class="ps-icon" viewBox="0 0 24 24"><path d="M9.5 4.2 4 6.3v13l5.5-2.1 5 2.1 5.5-2.1v-13l-5.5 2.1-5-2.1Zm0 2.3 5 2.1v9l-5-2.1v-9Zm-1 9.2-3.5 1.3v-9l3.5-1.3v9Zm11-7.7v9l-3.5 1.3v-9l3.5-1.3Z" fill="currentColor"/></svg>
            </span>
            <span class="ps-tabbar__label">Карта</span>
        </a>
        <a href="{% url 'user_dashboard' %}" class="ps-tabbar__item" data-nav="bookings" aria-label="Брони">
            <span class="ps-tabbar__icon" aria-hidden="true">
                <svg class="ps-icon" viewBox="0 0 24 24"><path d="M7 4.5h10c.8 0 1.5.7 1.5 1.5v12a1.5 1.5 0 0 1-1.5 1.5H7A1.5 1.5 0 0 1 5.5 18V6c0-.8.7-1.5 1.5-1.5Zm0 1.5V9h10V6H7Zm0 4v6h10v-6H7Z" fill="currentColor"/></svg>
            </span>
            <span class="ps-tabbar__label">Брони</span>
        </a>
        <a href="{% url 'owner_dashboard' %}" class="ps-tabbar__item" data-nav="parking" aria-label="Моя парковка">
            <span class="ps-tabbar__icon" aria-hidden="true">
                <svg class="ps-icon" viewBox="0 0 24 24"><path d="M7.5 4h7A3.5 3.5 0 0 1 18 7.5c0 1.9-1.6 3.5-3.5 3.5H9v6H7.5V4Zm7 6A2.5 2.5 0 0 0 17 7.5 2.5 2.5 0 0 0 14.5 5H9v5h5.5Z" fill="currentColor"/></svg>
            </span>
            <span class="ps-tabbar__label">Моя парковка</span>
        </a>
        <a href="{% url 'ai_chat' %}" class="ps-tabbar__item" data-nav="assistant" aria-label="Ассистент">
            <span class="ps-tabbar__icon" aria-hidden="true">
                <svg class="ps-icon" viewBox="0 0 24 24"><path d="M12 3a7 7 0 0 0-7 7v3.5A4.5 4.5 0 0 0 9.5 18h.8l1.7 2.6c.4.6 1.3.6 1.7 0L15.5 18h.8A4.5 4.5 0 0 0 19 13.5V10a7 7 0 0 0-7-7Zm0 2a5 5 0 0 1 5 5v3.5a2.5 2.5 0 0 1-2.5 2.5h-1.4l-1.1 1.8-1.1-1.8H9.5A2.5 2.5 0 0 1 7 13.5V10a5 5 0 0 1 5-5Z" fill="currentColor"/></svg>
            </span>
            <span class="ps-tabbar__label">Ассистент</span>
        </a>
    </nav>

    <div class="ps-install-banner" data-install-banner hidden>
        <div class="ps-install-banner__inner">
            <div class="ps-install-banner__text">
                Установите <strong>ParkShare RU</strong> как приложение
            </div>
            <div class="ps-install-banner__actions">
                <button type="button" class="ps-btn ps-btn-secondary" data-install-dismiss>Позже</button>
                <button type="button" class="ps-btn" data-install-accept>Установить</button>
            </div>
        </div>
    </div>

    <div class="ps-onboarding" data-onboarding hidden>
        <div class="ps-onboarding__backdrop"></div>
        <div class="ps-onboarding__card">
            <div class="ps-onboarding__slides" data-onboarding-slides>
                <article class="ps-onboarding__slide is-active">
                    <p class="ps-kicker">AI-консьерж</p>
                    <h2>Ищет парковку по маршруту</h2>
                    <p>Учитывает бюджет, EV и крытые места, запоминает предпочтения.</p>
                </article>
                <article class="ps-onboarding__slide">
                    <p class="ps-kicker">Прогнозы</p>
                    <h2>Подсказки по цене и загруженности</h2>
                    <p>Stress index, подсказки 1/3/24h и статус мест прямо в карточках.</p>
                </article>
                <article class="ps-onboarding__slide">
                    <p class="ps-kicker">PWA + оффлайн</p>
                    <h2>Работает без сети</h2>
                    <p>Кэширует недавние места, предлагает установить на экран, напоминает о завершении брони.</p>
                </article>
            </div>
            <div class="ps-onboarding__actions">
                <button type="button" class="ps-btn ps-btn-ghost" data-onboarding-skip>Пропустить</button>
                <button type="button" class="ps-btn" data-onboarding-next>Далее</button>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/app.js' %}"></script>
<script src="{% static 'js/theme.js' %}"></script>
{% block extra_scripts %}{% endblock %}
</body>
</html>
